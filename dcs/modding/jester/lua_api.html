<!DOCTYPE HTML>
<html lang="en" class="hb_light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lua API - Heatblur F-4E Phantom II</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Manual of the F-4E Phantom by Heatblur Simulations.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../theme/visual.css">
        <link rel="stylesheet" href="../../../theme/hb_light.css">
        <link rel="stylesheet" href="../../../theme/hb_dark.css">
        <link rel="stylesheet" href="../../../theme/pdf.css">

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "hb_dark" : "hb_light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('hb_light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="hb_light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="hb_dark">Dark</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="pdf">(PDF)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Heatblur F-4E Phantom II</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this manual" aria-label="Print this manual">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Heatblur-Simulations/f-4e-manual/releases" title="PDF version" aria-label="PDF version">
                            <i id="pdf-button" class="fa fa-file-pdf-o"></i>
                        </a>
                        <a href="https://github.com/Heatblur-Simulations/f-4e-manual" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/Heatblur-Simulations/f-4e-manual/edit/master/src/dcs/modding/jester/lua_api.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this manual ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="lua-api"><a class="header" href="#lua-api">Lua API</a></h1>
<p>This gives a quick overview of Lua, which Jester is primarily coded in; and
explains the Jester API itself, as well as how to create custom mods.</p>
<h2 id="get-started-with-lua"><a class="header" href="#get-started-with-lua">Get started with Lua</a></h2>
<p>Useful links:</p>
<ul>
<li>Lua Doc: <a href="https://www.lua.org/docs.html">https://www.lua.org/docs.html</a></li>
</ul>
<h3 id="tables"><a class="header" href="#tables">Tables</a></h3>
<p>Lua in itself is a fairly simple language with not too many features. It
primarily revolves around the use of tables. Tables can be compared to arrays,
lists and dictionaries, or maps.</p>
<pre><code class="language-lua">-- dictionary
local person = {
  name = "John",
  age = 20,
}

-- array/list
local fruits = { "Orange", "Apple", "Lemon" }
</code></pre>
<p>Arrays also implicitly decay to dictionaries with ascending keys <code>1</code>, <code>2</code>, etc.</p>
<p>Access can be either in a lookup-style <code>person["age"] = 21</code>, or like fields
<code>person.age = 21</code>.</p>
<p>In Lua, indices start <strong>counting at 1:</strong></p>
<pre><code class="language-lua">print(fruits[1]) -- Orange
</code></pre>
<p>The length of a table can be accessed using <code>#</code>:</p>
<pre><code class="language-lua">-- appending to a table
fruits[#fruits + 1] = "Cherry"
</code></pre>
<p>Anything not explicitly set is given the value <code>nil</code>.</p>
<h3 id="syntax-example"><a class="header" href="#syntax-example">Syntax example</a></h3>
<pre><code class="language-lua">function ageCheck(name, age)
  if age &lt; 18 then
    print("Sorry", name)
  else
    print("Okay", name)
  end
end
</code></pre>
<h3 id="classes"><a class="header" href="#classes">Classes</a></h3>
<p>Lua itself does not provide classes. However, we created a framework to add
class-like structures to Lua:</p>
<pre><code class="language-lua">local Class = require('base.Class')

local Person = Class()
Person.name = nil -- fields
Person.age = nil

function Person:Constructor(name, age)
  self.name = name
  self.age = age
end

Person:Seal() -- Prevent adding/removing more values/functions to it
</code></pre>
<p>The framework also supports inheritance:</p>
<pre><code class="language-lua">local Class = require('base.Class')
local Behavior = require('base.Behavior')

local AssistAAR = Class(Behavior) -- inherits from Behavior
</code></pre>
<h2 id="debugging"><a class="header" href="#debugging">Debugging</a></h2>
<p>Unfortunately, we do not have any Lua debugger setup. One has to rely on caveman
debugging with prints.</p>
<p>To aid in that, Jester offers an in-game console UI (<kbd>RCTRL</kbd>+<kbd>L</kbd>).
This console displays any string logged via <code>Log(...)</code>.</p>
<p>Further, it offers a console prompt allowing execution of Lua code.</p>
<p><img src="../../../img/jester_console_hello_world.jpg" alt="jester_console_hello_world" /></p>
<p>The prompt can also be used to inspect the running code, for example by entering
a command such as</p>
<pre><code class="language-lua">Log(GetJester().behaviors[require('radar.MoveRadarAntenna')].current_antenna_degrees.value)
</code></pre>
<p><img src="../../../img/jester_console_inspect.jpg" alt="jester_console_inspect" /></p>
<blockquote>
<p>🚧 HB UI does not support the full keyboard yet, for example <code>().[]:"'</code> cannot be entered.
It is thus recommended to prepare the prompt in an external text editor and simply
copy-paste it into the UI instead.</p>
</blockquote>
<p>We also provide a Lua playground in <code>WizardJester.lua</code>, which is always executed
directly on startup.</p>
<p>It is also possible to edit Lua files while DCS runs, without restarting the
game. Simply edit a LUA file and then reload the DCS mission with
<kbd>CTRL</kbd>+<kbd>R</kbd> and the new Lua file will be effective.</p>
<h2 id="user-mods"><a class="header" href="#user-mods">User Mods</a></h2>
<h3 id="add-content"><a class="header" href="#add-content">Add content</a></h3>
<p>Custom Jester logic is placed in the <strong>Saved Games</strong> folder, within the <code>jester\mods</code> subfolder.
The full path might for example look like:</p>
<p><code>C:\Users\John Doe\Saved Games\DCS_F4E\jester\mods</code></p>
<p>Any Lua file placed in this folder will be made available and can be loaded
through for example <code>require 'MyFile'</code> within Lua.</p>
<p>Any Lua file placed in the subfolder <code>jester\mods\init</code> will not only be made available,
but also be executed when spawning into the aircraft. This mechanism allows
announcing your custom content and adding it to Jester through a callback register called <code>mod_init</code>:</p>
<pre><code class="language-lua">-- Place this in a LUA file in jester\mods\init
mod_init[#mod_init+1] = function(jester)
  -- Executed at spawn, use 'jester' to register your logic
  Log("Hello World!")
end
</code></pre>
<blockquote>
<p>💡 When the <code>jester\mods</code> folder does not exist, it will be automatically created
on first spawn of the aircraft. Further, the folder will be pre-populated with
a simple <code>ExampleMod</code>.</p>
</blockquote>
<h3 id="replace-content"><a class="header" href="#replace-content">Replace content</a></h3>
<p>Existing behavior of Jester can be replaced by simply adding a Lua file under
the same name than the original file you want to replace to the <code>jester\mods</code> folder.</p>
<p>For example, in order to replace <code>MoveRadarAntenna.lua</code>
(e.g. <code>G:\DCS World OpenBeta\Mods\aircraft\F-4E\Jester\radar\MoveRadarAntenna.lua</code>) with custom logic,
place a file that is called <code>MoveRadarAntenna.lua</code> as well into the modding folder
(e.g. <code>C:\Users\John Doe\Saved Games\DCS_F4E\jester\mods\radar\MoveRadarAntenna.lua</code>).</p>
<p>Now, when the existing logic tries to load this file using <code>require 'radar.MoveRadarAntenna'</code>,
your custom file will be prioritized and loaded instead. To get back the original behavior,
simply delete your custom file.</p>
<blockquote>
<p>🟡 CAUTION: It is not possible to replace any files from the following folders:</p>
<ul>
<li>base</li>
<li>memory</li>
<li>senses</li>
<li>stats</li>
</ul>
<p>Attempting to do so results in a warning message being shown and all Jester mods getting disabled.</p>
</blockquote>
<h2 id="jester-modding-repository"><a class="header" href="#jester-modding-repository">Jester Modding Repository</a></h2>
<!-- markdown-link-check-disable -->
<p>To share mods with others or propose integration of mods into the base game, content can be
uploaded to the public repository
<a href="https://github.com/Heatblur-Simulations/jester-modding">Heatblur-Simulations/jester-modding</a>.</p>
<!-- markdown-link-check-enable -->
<p>This repository also contains the source files of Jester to aid modders in learning the Api,
but also to enable modification of existing logic.</p>
<h2 id="jester-api"><a class="header" href="#jester-api">Jester API</a></h2>
<p>Jesters logic is divided into 6 layers of abstraction:</p>
<ul>
<li>Intention (<em>WIP</em>)</li>
<li>Plan (<em>WIP</em>)</li>
<li>Situation</li>
<li>Behavior</li>
<li>Task</li>
<li>Action</li>
</ul>
<p>The original logic is located in the DCS Mod-Folder, for example:</p>
<p><code>G:\DCS World OpenBeta\Mods\aircraft\F-4E\Jester</code></p>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>As an example that touches most of the layers, we want to create a feature that
lets Jester report the current speed every couple of seconds during flight.</p>
<p>Therefore, we start with a Situation. A situation needs an activation and
deactivation <strong>Condition:</strong></p>
<pre><code class="language-lua">-- Airborne.lua
local Class = require 'base.Class'
local Condition = require 'base.Condition'

local Airborne = {}
Airborne.True = Class(Condition)
Airborne.False = Class(Condition)

function IsAirborne()
  -- details on observations later
  return GetJester().awareness:GetObservation("airborne") or false
end

function Airborne.True:Check()
  return IsAirborne() -- activation condition
end

function Airborne.False:Check()
  return not IsAirborne() -- deactivation condition
end

Airborne.True:Seal()
Airborne.False:Seal()
return Airborne
</code></pre>
<p>Activation and deactivation conditions do not necessarily have to be the same.</p>
<p>Now, we can use this condition in our <code>Flight</code> situation and add our desired
behavior:</p>
<pre><code class="language-lua">-- Flight.lua
local Class = require 'base.Class'
local Situation = require 'base.Situation'
local Airborne = require 'conditions.Airborne'
local ReportSpeed = require 'behaviors.ReportSpeed'
-- behavior will be defined in the next step

local Flight = Class(Situation)

-- it simply expects a class with a :Check() method
Flight:AddActivationConditions(Airborne.True:new())
Flight:AddDeactivationConditions(Airborne.False:new())

function Flight:OnActivation()
  self:AddBehavior(ReportSpeed) -- start our behavior
end

function Flight:OnDeactivation()
  self:RemoveBehavior(ReportSpeed) -- stop our behavior
end

Flight:Seal()
return Flight
</code></pre>
<p>The situation also has to be registered in <code>F-4E_WSO.lua</code> (<em>WIP</em>):</p>
<pre><code class="language-lua">-- in F-4E_WSO.lua
...
function CreateF4E_WSOJester()
  ...
  wso::AddSituations(Flight:new())
  ...
end
</code></pre>
<p>Now, we can define our behavior:</p>
<pre><code class="language-lua">-- ReportSpeed.lua
local Class = require('base.Class')
local Behavior = require('base.Behavior')
local SaySpeed = require('tasks.common.SaySpeed')
-- Task will be defined in the next step

local ReportSpeed = Class(Behavior)

function ReportSpeed:Constructor()
  Behavior.Constructor(self)
end

function ReportSpeed:Tick()
  -- this is called periodically
  local task = SaySpeed:new(...) -- access to speed explained later
  GetJester():AddTask(task)
end

ReportSpeed:Seal()
return ReportSpeed
</code></pre>
<p>Now, this would let Jester say something on every tick, a bit too verbose. To
improve on this, the Urge-system has been created. We can wrap our task in an
<code>Urge</code> and it will only be called on a set interval (which is automatically
applied some variance based on Jesters fixation and stress level):</p>
<pre><code class="language-lua">-- ReportSpeed.lua
local Class = require('base.Class')
local Behavior = require('base.Behavior')
local Urge = require('base.Urge') -- added
local StressReaction = require('base.StressReaction') -- added
local SaySpeed = require('tasks.common.SaySpeed')

local ReportSpeed = Class(Behavior)

function ReportSpeed:Constructor()
  Behavior.Constructor(self)

  -- logic of the behavior
  local say_speed = function ()
    -- very simple in this case,
    -- but could also trigger multiple tasks based on conditions, if desired
    local task = SaySpeed:new(...)
    GetJester():AddTask(task)
    return {task}
  end

  -- define the urge
  self.urge = Urge:new({
    time_to_release = s(10), -- baseline interval (10s now)
    on_release_function = say_speed, -- what to execute
    stress_reaction = StressReaction.ignorance, -- how important is this to Jester
  })
  self.urge:Restart() -- start it
end

function ReportSpeed:Tick()
  -- we could also modify the urge now, if desired
  -- for example increasing the stress level
  self.urge:Tick() -- tick it
end

ReportSpeed:Seal()
return ReportSpeed
</code></pre>
<p>The next step is to create the actual Task that will take care of reporting the
given speed:</p>
<pre><code class="language-lua">-- SaySpeed.lua
local Class = require('base.Class')
local Task = require('base.Task')
local SayAction = require('actions.SayAction')

local SaySpeed = Class(Task)

function SaySpeed:Constructor(speed)
  Task.Constructor(self)

  local on_activation = function()
    if speed &lt; kt(500) then
      -- see PhrasesList.txt for all supported voice lines
      self:AddAction(SayAction('awareness/wereslow'))
    else
      self:AddAction(SayAction('awareness/werefast'))
    end
  end

  self:AddOnActivationCallback(on_activation)
end

SaySpeed:Seal()
return SaySpeed
</code></pre>
<p>The last part is the final <code>Action</code>, in our case <code>SayAction</code>. Actions are
usually very generic and basic. In most cases, the existing <code>SayAction</code> will be
all thats needed. Refer to <code>SayAction.lua</code> for how it works.</p>
<p>If a behavior has no extra need for a specific task and just wants to say a
phrase, one can also directly use <code>SayTask</code>:</p>
<pre><code class="language-lua">-- in a Behaviors logic
...
local task = SayTask:new('misc/outoffuel')
GetJester():AddTask(task)
...
</code></pre>
<h3 id="lreal-and-units"><a class="header" href="#lreal-and-units">LReal and units</a></h3>
<p>A very common need is to work with real values and units, such as speed or time.
Therefore, we have <code>LReal</code>s, with units defined in <code>LUnit</code>.</p>
<pre><code class="language-lua">local time = min(15)
local speed = kt(500)
local fuel = lb(12000)

if time &gt; s(10) then
  print("foo")
end

time = time - s(40)
</code></pre>
<p>Careful when doing scalar operations:</p>
<pre><code class="language-lua">-- correct
time *= 2

-- incorrect
time *= s(2)
</code></pre>
<p>Latter would result in an invalid <code>LReal</code>, which can be checked for using
<code>time:IsValid()</code>.</p>
<p>If necessary, values can be converted to another unit:</p>
<pre><code class="language-lua">local timeInSeconds = time:ConvertTo(s)
print("Time:", timeInSeconds)
</code></pre>
<p><code>time.value</code> would access the raw underlying number.</p>
<h3 id="accessing-properties"><a class="header" href="#accessing-properties">Accessing properties</a></h3>
<p>Lua has full access to all <code>Property</code>s defined in our components and can access
them easily with <code>GetProperty</code>:</p>
<pre><code class="language-lua">function GetTotalFuelQuantity()
  local gauge_readout = GetProperty(
    "/Pilot Fuel Quantity Indicator/Fuel Meter", -- path
    "Internal Fuel Quantity Indication" -- property name
  ).value

  return gauge_readout or lb(10000)
end
</code></pre>
<p><code>GetProperty</code> expects the full path to the component within the component-tree
(that are all names of parent components), they must start with <code>/</code> to
indicate an absolute path.</p>
<p>The returned value is a wrapper <code>Property</code> object. Access to the underlying
value (in this case a <code>LReal</code> with unit <code>Pounds</code>) is given by
<code>GetProperty(...).value</code>.</p>
<!-- markdown-link-check-disable -->
<p>See the <code>properties_snapshot.json</code> file in the
<a href="https://github.com/Heatblur-Simulations/jester-modding">Heatblur-Simulations/jester-modding</a>
repository for a full list of all readable properties.</p>
<!-- markdown-link-check-enable -->
<p><img src="../../../img/properties_snapshot.jpg" alt="properties_snapshot" /></p>
<blockquote>
<p>💡 Open the file with a browser to skim and search through it.</p>
</blockquote>
<h3 id="observations-and-senses"><a class="header" href="#observations-and-senses">Observations and Senses</a></h3>
<p>Additionally to direct property access, Jester has an Observation-System. The
system allows to make frequently used data accessible in an easy way, or also to
provide more complex data, i.e. coming from the DCS SDK.</p>
<p>Observations are part of <code>Sense</code>s, of which Jester has several (eyes, ears, …).
As of now, most of them are <em>WIP</em>.</p>
<pre><code class="language-lua">local isAirborne = GetJester().awareness:GetObservation("airborne") or false
</code></pre>
<h2 id="interactions"><a class="header" href="#interactions">Interactions</a></h2>
<p>One key aspect of Jester is that he can interact with the cockpit by clicking
switches, buttons and turning knobs.</p>
<p>Therefore, the API offers two approaches.</p>
<h3 id="component-interactions"><a class="header" href="#component-interactions">Component Interactions</a></h3>
<p>The preferred way to interact with the cockpit is via the component system.</p>
<p>To allow interaction, a manipulator has to be registered at <code>F_4E_WSO_Cockpit.lua</code>:</p>
<pre><code class="language-lua">-- ChaffMode: OFF, SGL, MULT, PROG
self:AddManipulator(
  "Chaff Mode",
  {component_path = "/WSO Cockpit/WSO Left Console/AN_ALE-40 CCU/Chaff Mode Knob"}
)
</code></pre>
<p>After that, it can easily be interacted with, for example:</p>
<pre><code class="language-lua">task:AddAction(SwitchAction:new("Chaff Mode", "MULT"))
-- or in short
task:Click("Chaff Mode", "MULT")
</code></pre>
<p>or reading its current value:</p>
<pre><code class="language-lua">local cockpit = GetJester():GetCockpit()
local chaff_mode = cockpit:GetManipulator("Chaff Mode"):GetState()
</code></pre>
<h3 id="raw-interactions"><a class="header" href="#raw-interactions">Raw Interactions</a></h3>
<p>If the desired switch does not support the component interface yet,
one can instead fall back on a raw interface that invokes DCS commands directly,
as if the player would have triggered a bind manually.</p>
<pre><code class="language-lua">-- sends value 1 via command WSO_EJECT_INSTANT to device EJECTION_SEAT_SYSTEM
ClickRaw(devices.EJECTION_SEAT_SYSTEM, device_commands.WSO_EJECT_INSTANT, 1)

-- sends the value corresponding to position 2 on a 7-position knob
ClickRawKnob(devices.HUD_AN_ASG_26, device_commands.HUD_SelectHUDMode, 2, 7)
</code></pre>
<p>See <code>devices.lua</code> for all available devices and likewise <code>command_defs.lua</code> for
the commands.</p>
<p>In general, Knobs and 2-pos switches use the range <code>[0, 1]</code> for values, while
3-pos switches often (but not always) use <code>[-1, +1]</code>. For 3-pos switches <code>-1</code> is
usually used to move a 3-pos switch down, <code>+1</code> to move it up - but some switches
have a different orientation. See <code>default.lua</code> and <code>clickabledata.lua</code> to learn
more about a specific switch and how it reacts to values.</p>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<p>Next to clicking switches, Jester can react to events send either from C++ or
also from within Lua. The system follows a simple observer/listener pattern:</p>
<pre><code class="language-lua">ListenTo("go_silent", "Radar", function(task)
  task:Click("Radar Power", "STBY")
end)
</code></pre>
<p>with:</p>
<pre><code class="language-lua">if is_aar then
  DispatchEvent("go_silent")
end
</code></pre>
<h2 id="task-api"><a class="header" href="#task-api">Task API</a></h2>
<p>A core aspect of writing logic for Jester revolves around using the <code>Task</code> class.
Tasks consist of a sequence of <code>Action</code>s. A task can be paused, resumed or cancelled entirely by
the system if necessary.</p>
<p>Actions are, by design, executed asynchronously. Executing a click will take some time and
not execute instantly. In particular, adding a click action to a task will not block the code,
it simply gets added to the chain of actions to execute eventually.</p>
<p>This concept is similar to Future-APIs in other languages and <code>Task</code> offers a fluent-API to deal
with it conveniently.</p>
<p>Consider the following example:</p>
<pre><code class="language-lua">local task = Task:new()
task:Roger()
  :Click("Radar Power", "OPER")
  :Wait(min(4))
  :Click("Screen Mode", "radar")
  :Say("phrases/radar_ready")
  :Then(function()
    self.scan_for_bandits = true
  end)
</code></pre>
<p>Among other functions, the API offers:</p>
<ul>
<li><code>AddAction</code> - any <code>Action</code>, basis for the API</li>
<li><code>Then</code> - anonymous function</li>
<li><code>Wait</code> - time</li>
<li><code>WaitUntil</code> - predicate</li>
<li><code>Say</code> - phrase</li>
<li><code>Roger</code></li>
<li><code>CantDo</code></li>
<li><code>Click</code> - name, state</li>
<li><code>ClickFast</code> - name, state</li>
<li><code>ClickShort</code> - name, state</li>
<li><code>ClickShortFast</code> - name, state</li>
</ul>
<p>Refer to <code>Task.lua</code> for details.</p>
<h2 id="ui"><a class="header" href="#ui">UI</a></h2>
<p>Jester provides two types of user interfaces. A wheel with selectable options
and a dialog with questions and selectable answers that are shown on demand. See
<a href="wheel_ui.html">Wheel UI</a> and <a href="dialog_ui.html">Dialog UI</a> for more.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Navigation button at bottom -->
                            <a rel="prev" href="../../../dcs/modding/jester/voice_files.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i><span class="nav-chapters-text">Prev</span>
                            </a>

                            <a rel="next prefetch" href="../../../dcs/modding/jester/wheel_ui.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class="nav-chapters-text">Next</span><i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                    <nav class="nav-wide-wrapper" aria-label="Page navigation">
                            <!-- Navigation button at bottom -->
                            <a rel="prev" href="../../../dcs/modding/jester/voice_files.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i><span class="nav-chapters-text">Prev</span>
                            </a>
                            <!-- Navigation button on the left, not displayed, but needed for Aria nav -->
                            <a rel="prev" href="../../../dcs/modding/jester/voice_files.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class="nav-chapters-text">Next</span><i class="fa fa-angle-left"></i>
                            </a>

                            <!-- Navigation button at bottom -->
                            <a rel="next prefetch" href="../../../dcs/modding/jester/wheel_ui.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i><span class="nav-chapters-text">Next</span>
                            </a>
                            <!-- Navigation button on the right, not displayed, but needed for Aria nav -->
                            <a rel="next prefetch" href="../../../dcs/modding/jester/wheel_ui.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class="nav-chapters-text">Next</span><i class="fa fa-angle-right"></i>
                            </a>
                    </nav>
                </div>
            </div>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../js/jquery-3.7.1.min.js"></script>
        <script src="../../../js/extra.js"></script>


    </div>
    </body>
</html>
